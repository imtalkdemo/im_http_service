<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qunar.qchat.dao.ISendMsgDao">

    <resultMap id="BaseResultMap" type="com.qunar.qchat.model.SendWhiteModel">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="appcode" property="appcode" jdbcType="VARCHAR"/>
        <result column="ip_list" property="ip" jdbcType="ARRAY"
                typeHandler="com.qunar.qchat.handler.ArryTypeHandler"/>
        <result column="from_user" property="fromUser" jdbcType="VARCHAR"/>
        <result column="owner_user" property="ownerUser" jdbcType="VARCHAR"/>
        <result column="review_flag" property="reviewFlag" jdbcType="INTEGER"/>
    </resultMap>
    <insert id="insertSelective" parameterType="com.qunar.qchat.model.SendWhiteModel">
        insert into send_msg_white
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="appcode != null">
                appcode,
            </if>
            <if test="ip != null">
                ip_list,
            </if>
            <if test="fromUser != null">
                from_user,
            </if>
            <if test="ownerUser != null">
                owner_user,
            </if>
            <if test="reviewFlag != null">
                review_flag,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">

            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="appcode != null">
                #{appcode,jdbcType=VARCHAR},
            </if>
            <if test="ip != null">
                #{ip,jdbcType=ARRAY,typeHandler = com.qunar.qchat.handler.ArryTypeHandler},
            </if>
            <if test="fromUser != null">
                #{fromUser,jdbcType=VARCHAR},
            </if>
            <if test="ownerUser != null">
                #{ownerUser,jdbcType=VARCHAR},
            </if>
            <if test="reviewFlag != null">
                #{reviewFlag,jdbcType=INTEGER},
            </if>
        </trim>
        ON conflict(from_user,appcode) DO NOTHING;
    </insert>
    <select id="selectByappcode" resultMap="BaseResultMap" parameterType="java.lang.String">
    SELECT * FROM send_msg_white where appcode=#{appcode};
</select>
    <select id="selectByFromUser" resultMap="BaseResultMap" parameterType="java.lang.String">
        SELECT * FROM send_msg_white WHERE  from_user =#{fromUser};
    </select>
    <select id="selectReview" resultMap="BaseResultMap">
        select * from send_msg_white where review_flag=0;
    </select>
    <delete id="deleteWhiteById" parameterType="java.lang.Integer">
        delete from send_msg_white where id=#{id};
    </delete>
    <update id="updateReviewFlag">
    UPDATE send_msg_white set review_flag=#{review} where id=#{id};
</update>

    <select id="selectById" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        select * from send_msg_white where id=#{id};
    </select>

</mapper>